isFullscreen=false;var app={initialize:function(){document.addEventListener("deviceready",this.onDeviceReady.bind(this),false)},onDeviceReady:function(){this.receivedEvent("deviceready")},receivedEvent:function(a){console.log("Received Event: "+a)}};app.initialize();storage=window.localStorage;$("#token").val(storage.getItem("token"));document.addEventListener("backbutton",function(a){if(isFullscreen){a.preventDefault();navigator.app.backHistory()}else{a.preventDefault();navigator.app.exitApp()}},false);const url="https://derpibooru.org/search.json?q=";const webm="img/webm.png";let tags;page=1;images=[];index=0;$("#search").click(function(){loadImages()});function loadImages(){tags=$("#searchbar").val();tags=tags.replace(/ /g,"+").replace(/,/g,"%2C");var b=storage.getItem("token");let query=url+tags+"&page="+page+"&key="+b;$.ajax({url:query,success:a});function a(c){let i;let type;let full;for(i=0;i<c.search.length;i++){let img=c.search[i];let thumb="https:"+img.representations.thumb;type=img.mime_type;full="https:"+img.representations.medium;images.push(img);if(type==="video/webm"){$(".content").append("<div class='image-container'><img class='image' src='"+webm+"' onclick='openFullscreen(\""+i+"\")'></div>")}else{$(".content").append("<div class='image-container'><img class='image' src='"+thumb+"' onclick='openFullscreen(\""+i+"\")'></div>")}}}page+=1}function openFullscreen(d){d=parseInt(d);index=Math.max(0,d);$(".fullscreen").addClass("enabled");let img=images[d];var b="https:"+img.representations.medium;var c=img.mime_type;var a;if(c==="video/webm"){a="<video class='full-image' src='"+b+"' controls loop autoplay>"}else{a="<img class='full-image' src='"+b+"'>"}$("#fullscreenImg").html(a);if(d>images.length-5){loadImages()}}function closeFullscreen(){$(".fullscreen").removeClass("enabled");$("#fullscreenImg").html("")}function nextImage(){openFullscreen(index+1)}function prevImage(){openFullscreen(index-1)}function openSidebar(){$(".sidebar").addClass("enabled")}function closeSidebar(){$(".sidebar").removeClass("enabled")}$("#saveToken").click(function(){let token=$("#token").val();storage.setItem("token",token)});